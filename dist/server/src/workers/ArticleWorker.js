'use strict';

var cov_1j1qvmvkqk = function () {
  var path = '/Users/ovieokeh/Desktop/noldor-ah-backend/server/src/workers/ArticleWorker.js',
      hash = '312cb8c29d63ec6f5aa44320a4424d1ed83ad988',
      Function = function () {}.constructor,
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/ovieokeh/Desktop/noldor-ah-backend/server/src/workers/ArticleWorker.js',
    statementMap: {
      '0': {
        start: {
          line: 5,
          column: 15
        },
        end: {
          line: 5,
          column: 24
        }
      },
      '1': {
        start: {
          line: 6,
          column: 26
        },
        end: {
          line: 6,
          column: 32
        }
      },
      '2': {
        start: {
          line: 18,
          column: 4
        },
        end: {
          line: 26,
          column: 7
        }
      },
      '3': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 42,
          column: 7
        }
      },
      '4': {
        start: {
          line: 52,
          column: 4
        },
        end: {
          line: 82,
          column: 5
        }
      },
      '5': {
        start: {
          line: 53,
          column: 17
        },
        end: {
          line: 53,
          column: 47
        }
      },
      '6': {
        start: {
          line: 54,
          column: 20
        },
        end: {
          line: 54,
          column: 22
        }
      },
      '7': {
        start: {
          line: 56,
          column: 6
        },
        end: {
          line: 58,
          column: 7
        }
      },
      '8': {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 57,
          column: 37
        }
      },
      '9': {
        start: {
          line: 59,
          column: 6
        },
        end: {
          line: 61,
          column: 7
        }
      },
      '10': {
        start: {
          line: 60,
          column: 8
        },
        end: {
          line: 60,
          column: 41
        }
      },
      '11': {
        start: {
          line: 62,
          column: 6
        },
        end: {
          line: 64,
          column: 7
        }
      },
      '12': {
        start: {
          line: 63,
          column: 8
        },
        end: {
          line: 63,
          column: 49
        }
      },
      '13': {
        start: {
          line: 65,
          column: 6
        },
        end: {
          line: 74,
          column: 8
        }
      },
      '14': {
        start: {
          line: 76,
          column: 6
        },
        end: {
          line: 81,
          column: 9
        }
      },
      '15': {
        start: {
          line: 92,
          column: 15
        },
        end: {
          line: 92,
          column: 45
        }
      },
      '16': {
        start: {
          line: 93,
          column: 25
        },
        end: {
          line: 99,
          column: 6
        }
      },
      '17': {
        start: {
          line: 100,
          column: 4
        },
        end: {
          line: 105,
          column: 5
        }
      },
      '18': {
        start: {
          line: 101,
          column: 6
        },
        end: {
          line: 104,
          column: 9
        }
      },
      '19': {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 106,
          column: 24
        }
      },
      '20': {
        start: {
          line: 118,
          column: 15
        },
        end: {
          line: 118,
          column: 45
        }
      },
      '21': {
        start: {
          line: 119,
          column: 4
        },
        end: {
          line: 149,
          column: 5
        }
      },
      '22': {
        start: {
          line: 120,
          column: 27
        },
        end: {
          line: 132,
          column: 8
        }
      },
      '23': {
        start: {
          line: 133,
          column: 6
        },
        end: {
          line: 140,
          column: 7
        }
      },
      '24': {
        start: {
          line: 134,
          column: 8
        },
        end: {
          line: 139,
          column: 11
        }
      },
      '25': {
        start: {
          line: 141,
          column: 6
        },
        end: {
          line: 141,
          column: 26
        }
      },
      '26': {
        start: {
          line: 143,
          column: 6
        },
        end: {
          line: 148,
          column: 9
        }
      },
      '27': {
        start: {
          line: 158,
          column: 4
        },
        end: {
          line: 171,
          column: 5
        }
      },
      '28': {
        start: {
          line: 159,
          column: 6
        },
        end: {
          line: 163,
          column: 9
        }
      },
      '29': {
        start: {
          line: 165,
          column: 6
        },
        end: {
          line: 170,
          column: 9
        }
      },
      '30': {
        start: {
          line: 180,
          column: 4
        },
        end: {
          line: 196,
          column: 5
        }
      },
      '31': {
        start: {
          line: 181,
          column: 6
        },
        end: {
          line: 190,
          column: 8
        }
      },
      '32': {
        start: {
          line: 192,
          column: 6
        },
        end: {
          line: 195,
          column: 9
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 17,
            column: 2
          },
          end: {
            line: 17,
            column: 3
          }
        },
        loc: {
          start: {
            line: 17,
            column: 32
          },
          end: {
            line: 27,
            column: 3
          }
        },
        line: 17
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 35,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        loc: {
          start: {
            line: 35,
            column: 44
          },
          end: {
            line: 43,
            column: 3
          }
        },
        line: 35
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 51,
            column: 2
          },
          end: {
            line: 51,
            column: 3
          }
        },
        loc: {
          start: {
            line: 51,
            column: 39
          },
          end: {
            line: 83,
            column: 3
          }
        },
        line: 51
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 91,
            column: 2
          },
          end: {
            line: 91,
            column: 3
          }
        },
        loc: {
          start: {
            line: 91,
            column: 38
          },
          end: {
            line: 107,
            column: 3
          }
        },
        line: 91
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 117,
            column: 2
          },
          end: {
            line: 117,
            column: 3
          }
        },
        loc: {
          start: {
            line: 117,
            column: 37
          },
          end: {
            line: 150,
            column: 3
          }
        },
        line: 117
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 157,
            column: 2
          },
          end: {
            line: 157,
            column: 3
          }
        },
        loc: {
          start: {
            line: 157,
            column: 45
          },
          end: {
            line: 172,
            column: 3
          }
        },
        line: 157
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 179,
            column: 2
          },
          end: {
            line: 179,
            column: 3
          }
        },
        loc: {
          start: {
            line: 179,
            column: 39
          },
          end: {
            line: 197,
            column: 3
          }
        },
        line: 179
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 56,
            column: 6
          },
          end: {
            line: 58,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 56,
            column: 6
          },
          end: {
            line: 58,
            column: 7
          }
        }, {
          start: {
            line: 56,
            column: 6
          },
          end: {
            line: 58,
            column: 7
          }
        }],
        line: 56
      },
      '1': {
        loc: {
          start: {
            line: 59,
            column: 6
          },
          end: {
            line: 61,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 59,
            column: 6
          },
          end: {
            line: 61,
            column: 7
          }
        }, {
          start: {
            line: 59,
            column: 6
          },
          end: {
            line: 61,
            column: 7
          }
        }],
        line: 59
      },
      '2': {
        loc: {
          start: {
            line: 62,
            column: 6
          },
          end: {
            line: 64,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 62,
            column: 6
          },
          end: {
            line: 64,
            column: 7
          }
        }, {
          start: {
            line: 62,
            column: 6
          },
          end: {
            line: 64,
            column: 7
          }
        }],
        line: 62
      },
      '3': {
        loc: {
          start: {
            line: 100,
            column: 4
          },
          end: {
            line: 105,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 100,
            column: 4
          },
          end: {
            line: 105,
            column: 5
          }
        }, {
          start: {
            line: 100,
            column: 4
          },
          end: {
            line: 105,
            column: 5
          }
        }],
        line: 100
      },
      '4': {
        loc: {
          start: {
            line: 133,
            column: 6
          },
          end: {
            line: 140,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 133,
            column: 6
          },
          end: {
            line: 140,
            column: 7
          }
        }, {
          start: {
            line: 133,
            column: 6
          },
          end: {
            line: 140,
            column: 7
          }
        }],
        line: 133
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0]
    },
    _coverageSchema: '43e27e138ebf9cfc5966b082cf9a028302ed4184'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _sequelize = require('sequelize');

var _sequelize2 = _interopRequireDefault(_sequelize);

var _models = require('../db/models');

var _models2 = _interopRequireDefault(_models);

var _index = require('../helpers/index');

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _ref = (cov_1j1qvmvkqk.s[0]++, _sequelize2.default),
    Op = _ref.Op;

var _ref2 = (cov_1j1qvmvkqk.s[1]++, _models2.default),
    User = _ref2.User,
    Article = _ref2.Article;

/**
 * @class { ArticleWorker }
 * @description { Handles for like and unlike }
 */


var ArticleWorker = function () {
  function ArticleWorker() {
    (0, _classCallCheck3.default)(this, ArticleWorker);
  }

  (0, _createClass3.default)(ArticleWorker, null, [{
    key: 'getAllArticles',

    /**
     * @description { worker to get all articles }
     * @returns { object } JSON
     */
    value: function () {
      var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                cov_1j1qvmvkqk.f[0]++;
                cov_1j1qvmvkqk.s[2]++;
                return _context.abrupt('return', Article.findAll({
                  where: {
                    published: true
                  },
                  attributes: ['slug', 'title', 'description', 'content', 'published', 'createdAt', 'updatedAt'],
                  include: [{
                    model: User, attributes: ['username', 'bio', 'avatarUrl']
                  }]
                }));

              case 3:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function getAllArticles() {
        return _ref3.apply(this, arguments);
      }

      return getAllArticles;
    }()

    /**
     *
     * @param { string } id
     * @param { string } publish
     * @return { object } JSON
     */

  }, {
    key: 'getUserArticles',
    value: function () {
      var _ref4 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(id, publish) {
        return _regenerator2.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                cov_1j1qvmvkqk.f[1]++;
                cov_1j1qvmvkqk.s[3]++;
                return _context2.abrupt('return', Article.findAll({
                  where: {
                    userId: id,
                    published: publish
                  },
                  attributes: ['slug', 'title', 'description', 'published', 'content', 'createdAt', 'updatedAt']
                }));

              case 3:
              case 'end':
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function getUserArticles(_x, _x2) {
        return _ref4.apply(this, arguments);
      }

      return getUserArticles;
    }()

    /**
     *
     * @param { object } req
     * @param { object } res
     * @returns { object } JSON
     */

  }, {
    key: 'updateArticle',
    value: function () {
      var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3(req, res) {
        var id, input;
        return _regenerator2.default.wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                cov_1j1qvmvkqk.f[2]++;
                cov_1j1qvmvkqk.s[4]++;
                _context3.prev = 2;
                cov_1j1qvmvkqk.s[5]++;
                _context3.next = 6;
                return _index2.default.slugDecoder(req);

              case 6:
                id = _context3.sent;
                input = (cov_1j1qvmvkqk.s[6]++, {});
                cov_1j1qvmvkqk.s[7]++;


                if (req.body.title !== undefined) {
                  cov_1j1qvmvkqk.b[0][0]++;
                  cov_1j1qvmvkqk.s[8]++;

                  input.title = req.body.title;
                } else {
                  cov_1j1qvmvkqk.b[0][1]++;
                }
                cov_1j1qvmvkqk.s[9]++;
                if (req.body.content !== undefined) {
                  cov_1j1qvmvkqk.b[1][0]++;
                  cov_1j1qvmvkqk.s[10]++;

                  input.content = req.body.content;
                } else {
                  cov_1j1qvmvkqk.b[1][1]++;
                }
                cov_1j1qvmvkqk.s[11]++;
                if (req.body.description !== undefined) {
                  cov_1j1qvmvkqk.b[2][0]++;
                  cov_1j1qvmvkqk.s[12]++;

                  input.description = req.body.description;
                } else {
                  cov_1j1qvmvkqk.b[2][1]++;
                }
                cov_1j1qvmvkqk.s[13]++;
                return _context3.abrupt('return', Article.update(input, {
                  where: {
                    slug: (0, _defineProperty3.default)({}, Op.like, '%' + id)
                  }
                }));

              case 18:
                _context3.prev = 18;
                _context3.t0 = _context3['catch'](2);
                cov_1j1qvmvkqk.s[14]++;
                return _context3.abrupt('return', res.status(500).json({
                  success: false,
                  error: {
                    msg: _context3.t0.message
                  }
                }));

              case 22:
              case 'end':
                return _context3.stop();
            }
          }
        }, _callee3, this, [[2, 18]]);
      }));

      function updateArticle(_x3, _x4) {
        return _ref5.apply(this, arguments);
      }

      return updateArticle;
    }()

    /**
     *
     * @param { object } req
     * @param { object } res
     * @return { object } JSON
     */

  }, {
    key: 'checkArticle',
    value: function () {
      var _ref6 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee4(req, res) {
        var id, articleExist;
        return _regenerator2.default.wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                cov_1j1qvmvkqk.f[3]++;
                cov_1j1qvmvkqk.s[15]++;
                _context4.next = 4;
                return _index2.default.slugDecoder(req);

              case 4:
                id = _context4.sent;
                cov_1j1qvmvkqk.s[16]++;
                _context4.next = 8;
                return Article.findOne({
                  where: {
                    slug: (0, _defineProperty3.default)({}, Op.like, '%' + id)
                  }
                });

              case 8:
                articleExist = _context4.sent;
                cov_1j1qvmvkqk.s[17]++;

                if (articleExist) {
                  _context4.next = 16;
                  break;
                }

                cov_1j1qvmvkqk.b[3][0]++;
                cov_1j1qvmvkqk.s[18]++;
                return _context4.abrupt('return', res.status(404).json({
                  success: false,
                  message: 'article not found'
                }));

              case 16:
                cov_1j1qvmvkqk.b[3][1]++;

              case 17:
                cov_1j1qvmvkqk.s[19]++;
                return _context4.abrupt('return', articleExist);

              case 19:
              case 'end':
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function checkArticle(_x5, _x6) {
        return _ref6.apply(this, arguments);
      }

      return checkArticle;
    }()

    /**
       * @description { Check if article has been reacted to by user }
       * @param { object } req
       * @param { object } res
       * @returns { boolean } TRUE/FALSE
       *
       */

  }, {
    key: 'findArticle',
    value: function () {
      var _ref7 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee5(req, res) {
        var id, articleExist;
        return _regenerator2.default.wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                cov_1j1qvmvkqk.f[4]++;
                cov_1j1qvmvkqk.s[20]++;
                _context5.next = 4;
                return _index2.default.slugDecoder(req);

              case 4:
                id = _context5.sent;
                cov_1j1qvmvkqk.s[21]++;
                _context5.prev = 6;
                cov_1j1qvmvkqk.s[22]++;
                _context5.next = 10;
                return Article.findOne({
                  where: {
                    slug: (0, _defineProperty3.default)({}, Op.like, '%' + id),
                    published: true
                  },
                  attributes: ['id', 'slug', 'title', 'description', 'published', 'content', 'createdAt', 'updatedAt'],
                  include: [{
                    model: User, attributes: ['id', 'username', 'bio', 'avatarUrl']
                  }]
                });

              case 10:
                articleExist = _context5.sent;
                cov_1j1qvmvkqk.s[23]++;

                if (articleExist) {
                  _context5.next = 18;
                  break;
                }

                cov_1j1qvmvkqk.b[4][0]++;
                cov_1j1qvmvkqk.s[24]++;
                return _context5.abrupt('return', res.status(404).json({
                  success: false,
                  error: {
                    message: 'article not found'
                  }
                }));

              case 18:
                cov_1j1qvmvkqk.b[4][1]++;

              case 19:
                cov_1j1qvmvkqk.s[25]++;
                return _context5.abrupt('return', articleExist);

              case 23:
                _context5.prev = 23;
                _context5.t0 = _context5['catch'](6);
                cov_1j1qvmvkqk.s[26]++;
                return _context5.abrupt('return', res.status(500).json({
                  success: false,
                  error: {
                    msg: _context5.t0.message
                  }
                }));

              case 27:
              case 'end':
                return _context5.stop();
            }
          }
        }, _callee5, this, [[6, 23]]);
      }));

      function findArticle(_x7, _x8) {
        return _ref7.apply(this, arguments);
      }

      return findArticle;
    }()

    /**
     * @param { object } articleId
     * @param { object } res
     * @returns { object } JSON
     */

  }, {
    key: 'deleteArticle',
    value: function () {
      var _ref8 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee6(articleId, res) {
        return _regenerator2.default.wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                cov_1j1qvmvkqk.f[5]++;
                cov_1j1qvmvkqk.s[27]++;
                _context6.prev = 2;
                cov_1j1qvmvkqk.s[28]++;
                return _context6.abrupt('return', Article.destroy({
                  where: {
                    id: articleId
                  }
                }));

              case 7:
                _context6.prev = 7;
                _context6.t0 = _context6['catch'](2);
                cov_1j1qvmvkqk.s[29]++;
                return _context6.abrupt('return', res.status(500).json({
                  success: false,
                  error: {
                    msg: _context6.t0.message
                  }
                }));

              case 11:
              case 'end':
                return _context6.stop();
            }
          }
        }, _callee6, this, [[2, 7]]);
      }));

      function deleteArticle(_x9, _x10) {
        return _ref8.apply(this, arguments);
      }

      return deleteArticle;
    }()

    /**
     * @param { string } articleId
     * @param { object } res
     * @return { object } JSON
     */

  }, {
    key: 'publish',
    value: function () {
      var _ref9 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee7(articleId, res) {
        return _regenerator2.default.wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                cov_1j1qvmvkqk.f[6]++;
                cov_1j1qvmvkqk.s[30]++;
                _context7.prev = 2;
                cov_1j1qvmvkqk.s[31]++;

                Article.update({
                  published: true
                }, {
                  where: {
                    id: articleId
                  }
                });
                _context7.next = 11;
                break;

              case 7:
                _context7.prev = 7;
                _context7.t0 = _context7['catch'](2);
                cov_1j1qvmvkqk.s[32]++;
                return _context7.abrupt('return', res.status(500).json({
                  success: false,
                  error: _context7.t0.message
                }));

              case 11:
              case 'end':
                return _context7.stop();
            }
          }
        }, _callee7, this, [[2, 7]]);
      }));

      function publish(_x11, _x12) {
        return _ref9.apply(this, arguments);
      }

      return publish;
    }()
  }]);
  return ArticleWorker;
}();

exports.default = ArticleWorker;
module.exports = exports.default;